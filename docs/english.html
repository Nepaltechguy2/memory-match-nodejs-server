<!DOCTYPE html>

<html>
<head>
  <title>english.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="english.html">
                  english.js
                </a>
              
                
                <a class="source" href="grant.html">
                  grant.js
                </a>
              
                
                <a class="source" href="gruntfile.html">
                  gruntfile.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="jquery-3.3.1.min.html">
                  jquery-3.3.1.min.js
                </a>
              
                
                <a class="source" href="server.html">
                  server.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>english.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>a mem match game for english class yay
made by samyok nepal. (c) 2018.
no part of this may be reproduced unless one or both of the following apply:
either
 the portion that is to be reproduced is from another source
 or with written permission from the author.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> APP_NAME = <span class="hljs-string">"English Memory Match"</span>;
<span class="hljs-keyword">const</span> startTime = <span class="hljs-built_in">Date</span>();
<span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./custom_modules/logger.js'</span>);
<span class="hljs-keyword">var</span> samyok = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./custom_modules/samyok.js'</span>)({
    <span class="hljs-string">"logger"</span>: logger
});

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> blah = <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(<span class="hljs-string">'./custom_modules/questions.json'</span>, <span class="hljs-string">'utf8'</span>));

<span class="hljs-keyword">var</span> socket = <span class="hljs-built_in">require</span>(<span class="hljs-string">"socket.io"</span>);
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">var</span> app = express(); <span class="hljs-comment">// server STUFF</span>
<span class="hljs-keyword">var</span> documentation = <span class="hljs-keyword">new</span> express();
<span class="hljs-keyword">var</span> jsdocFiles = <span class="hljs-keyword">new</span> express();
<span class="hljs-keyword">var</span> restart_code = randInt(<span class="hljs-number">10000</span>, <span class="hljs-number">9999999</span>);
app.get(<span class="hljs-string">'/restart_code='</span> + restart_code, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{ <span class="hljs-comment">// restart function</span>
    logger.error(<span class="hljs-string">"/restart HIT! RESTART NOOoOooOOOOO"</span>);
    res.send(<span class="hljs-string">'&lt;h1&gt;Server Restart&lt;/h1&gt;&lt;script&gt;setTimeout(function(){location.href="/"}, 1000)&lt;/script&gt;'</span>);
    process.exit(<span class="hljs-number">1</span>);
});

logger.silly(<span class="hljs-string">"Imports done."</span>);

<span class="hljs-keyword">var</span> server = app.listen(<span class="hljs-number">4000</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    logger.info(<span class="hljs-string">"Started "</span> + APP_NAME + <span class="hljs-string">"'s express server. Listening to port 4000."</span>);
});
app.use(express.static(<span class="hljs-string">"public"</span>));

<span class="hljs-keyword">var</span> docsServer = documentation.listen(<span class="hljs-number">8080</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    logger.info(<span class="hljs-string">"Started "</span> + APP_NAME + <span class="hljs-string">"'s documentation server. Listening to port 8080."</span>);
});
documentation.use(express.static(<span class="hljs-string">"docs"</span>));


<span class="hljs-keyword">var</span> jsdocServer = jsdocFiles.listen(<span class="hljs-number">8081</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    logger.info(<span class="hljs-string">"Started "</span> + APP_NAME + <span class="hljs-string">"'s jsdoc server. Listening to port 8081."</span>);
});
jsdocFiles.use(express.static(<span class="hljs-string">"public/jsdocs/memnode/1.0.0"</span>));

<span class="hljs-keyword">var</span> io = socket(server);
logger.info(<span class="hljs-string">"Started "</span> + APP_NAME + <span class="hljs-string">"'s socket server."</span>);

<span class="hljs-keyword">var</span> place = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.clean = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; i++) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>[i] == a) {
                <span class="hljs-keyword">this</span>.splice(i, <span class="hljs-number">1</span>);
                i--
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };
}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>define vars and add .clean() functions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> users = <span class="hljs-keyword">new</span> place();
<span class="hljs-keyword">var</span> rooms = <span class="hljs-keyword">new</span> place();
<span class="hljs-keyword">var</span> lobbies = <span class="hljs-keyword">new</span> place();

io.on(<span class="hljs-string">"connection"</span>, (socket) =&gt; {
    <span class="hljs-keyword">var</span> key = socket.id;
    users[key] = {};
    logger.info(<span class="hljs-string">"+1 user! Key: "</span> + key + <span class="hljs-string">" Total: "</span> + samyok.count(users));
    users[key].logged_in = <span class="hljs-literal">false</span>;
    logger.silly(users);
    io.to(key).emit(<span class="hljs-string">"connected"</span>, {
        <span class="hljs-attr">connected</span>: <span class="hljs-literal">true</span>
    }); <span class="hljs-comment">// make sure that they are</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>connected and trigger login.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">"username"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>check if username exists:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> allow = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> users) {
            <span class="hljs-keyword">if</span> (users[a].username == data.username) {
                allow = <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">if</span> (allow) {
            users[key].logged_in = <span class="hljs-literal">true</span>;
            users[key].username = data.username;
            logger.silly(users);
            logger.info(<span class="hljs-string">"Login: "</span> + users[key].username);
            io.to(key).emit(<span class="hljs-string">"username_response"</span>, {
                <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
                <span class="hljs-attr">lobby</span>: <span class="hljs-string">"main"</span>,
                <span class="hljs-attr">username</span>: users[key].username
            });
            logger.info(<span class="hljs-string">"Move "</span> + users[key].username + <span class="hljs-string">" to lobby 'main'."</span>);
            <span class="hljs-keyword">if</span> (lobbies.main != <span class="hljs-literal">undefined</span>) {
                lobbies.main[key] = users[key].username;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> main = <span class="hljs-keyword">new</span> place();
                lobbies.main = main;
                lobbies.main[key] = users[key].username;
            }
            logger.silly(lobbies);
        } <span class="hljs-keyword">else</span> {
            io.to(key).emit(<span class="hljs-string">"username_response"</span>, {
                <span class="hljs-attr">message</span>: <span class="hljs-string">'error'</span>,
                <span class="hljs-attr">reason</span>: <span class="hljs-string">"Your username is taken. Please pick another one."</span>
            })
        }
    });
    socket.on(<span class="hljs-string">"create_room"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">switch</span> (data.type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"double"</span>:
                io.to(key).emit(<span class="hljs-string">'room_created'</span>, {
                    <span class="hljs-attr">room</span>: create_room(<span class="hljs-string">"double"</span>, key)
                })
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                io.to(key).emit(<span class="hljs-string">"error"</span>, {
                    <span class="hljs-attr">message</span>: <span class="hljs-string">"lol"</span>
                });
        }
    });
    socket.on(<span class="hljs-string">'samyok_says_restart'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        logger.warn(<span class="hljs-string">"Restart code Requested by "</span> + key);
        socket.emit(<span class="hljs-string">"console"</span>, {
            <span class="hljs-attr">href</span>: <span class="hljs-string">"/restart_code="</span> + restart_code
        });
    })
    socket.on(<span class="hljs-string">"join_room"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        join_room(data.code, key);
    });
    socket.on(<span class="hljs-string">"ready"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> rooms) {
            <span class="hljs-keyword">if</span> (rooms[a].gameInfo == <span class="hljs-literal">null</span> || rooms[a].gameInfo.leader == key) {
                <span class="hljs-keyword">var</span> other = <span class="hljs-string">"player2"</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> other = <span class="hljs-string">"leader"</span>;
            }
            <span class="hljs-keyword">if</span> (rooms[a].gameInfo == <span class="hljs-literal">undefined</span>) {
                <span class="hljs-keyword">delete</span> rooms[a];
                logger.error(<span class="hljs-string">"Deleted room "</span> + a + <span class="hljs-string">", the room's info was undefined."</span>);
                logger.silly(rooms);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rooms[a].gameInfo.leader == key) {
                rooms[a].ready.leader = <span class="hljs-literal">true</span>;
                logger.info(<span class="hljs-string">"Marked "</span> + users[key].username + <span class="hljs-string">" as ready to play in room "</span> + a + <span class="hljs-string">'.'</span>);
                logger.silly(rooms);
                start_game(a);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rooms[a].gameInfo.player2 == key) {
                rooms[a].ready.player2 = <span class="hljs-literal">true</span>;
                logger.info(<span class="hljs-string">"Marked "</span> + users[key].username + <span class="hljs-string">" as ready to play in room "</span> + a + <span class="hljs-string">'.'</span>);
                logger.silly(rooms);
                start_game(a);
            }
        }
    });
    <span class="hljs-built_in">Array</span>.prototype.clean = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; i++) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>[i] == d) {
                <span class="hljs-keyword">this</span>.splice(i, <span class="hljs-number">1</span>);
                i--;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };
    <span class="hljs-comment">/**
     * @param {string} room the room key
     * @return {void}
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start_game</span>(<span class="hljs-params">room</span>) </span>{
        logger.warn(blah);
        <span class="hljs-keyword">if</span> (!rooms[room].ready.leader || !rooms[room].ready.player2) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        logger.info(<span class="hljs-string">"Started game in room "</span> + room + <span class="hljs-string">"."</span>);
        rooms[room].started = <span class="hljs-number">1</span>;
        io.to(rooms[room].gameInfo.leader).emit(<span class="hljs-string">"game_start"</span>, {
            <span class="hljs-attr">first</span>: <span class="hljs-literal">true</span>
        });
        io.to(rooms[room].gameInfo.player2).emit(<span class="hljs-string">"game_start"</span>, {
            <span class="hljs-attr">first</span>: <span class="hljs-literal">false</span>
        });
        <span class="hljs-keyword">var</span> arr = [{
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Main character"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Guy Montag"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Montag's wife"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Mildred"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Last Person killed by Montag"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Captain Beatty"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"A machine that tries to kill Montag"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"The Hound"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"The book Montag memorized"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Book of Ecclesiastes"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Poem that Montag reads"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Dover Beach"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Temperature at which paper burns"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"451 degrees Farenheit"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Most important girl in the story"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Clarisse McClellan"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Author of Fahrenheit 451 "</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Ray Bradbury"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Number of walls in Mildred's \"family\""</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"3"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Clarisse makes Montag question this feeling"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Happiness"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Mildred ___, so techies were called. "</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Ate too many sleeping pills"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Leader of so-called \"criminals\" "</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Granger"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Montag original thoughts on burning"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Pleasing"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Montag convinced Faber to help him by..."</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Ripping pages out of the Bible"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"The Hound's weapon"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"A procaine needle"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"Name of fireman that Montag reported"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Black"</span>
            },
            {
                <span class="hljs-string">"question"</span>: <span class="hljs-string">"A(n) ___ man is killed instead of Montag"</span>,
                <span class="hljs-string">"answer"</span>: <span class="hljs-string">"Innocent"</span>
            }
        ];
        <span class="hljs-built_in">console</span>.log(arr);
        <span class="hljs-keyword">var</span> NUMBER_OF_CARDS = arr.length * <span class="hljs-number">2</span>; <span class="hljs-comment">//MUST BE EVEN</span>
        <span class="hljs-keyword">var</span> new_arr = rearrange();

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rearrange</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> newArr = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; NUMBER_OF_CARDS / <span class="hljs-number">2</span>; i++) {
                item = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * arr.length)
                newArr.push(arr[item].question);
                newArr.push(arr[item].answer);
                <span class="hljs-keyword">delete</span> arr[item];
                arr.clean(<span class="hljs-literal">null</span>);
            }
            <span class="hljs-keyword">return</span> newArr;
        }
        super_arr = shuffle(new_arr);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shuffle</span>(<span class="hljs-params">arr</span>) </span>{
            <span class="hljs-keyword">var</span> TheArr = arr;
            <span class="hljs-keyword">var</span> return_arr = [];
            <span class="hljs-keyword">var</span> iterations = TheArr.length;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
                <span class="hljs-keyword">var</span> theNumber = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (TheArr.length));
                return_arr.push(TheArr[theNumber]);
                <span class="hljs-keyword">delete</span> TheArr[theNumber];
                TheArr.clean();
            }
            <span class="hljs-keyword">return</span> return_arr;
        }
        rooms[room].game.turn = <span class="hljs-string">"leader"</span>;
        rooms[room].scores = {
            <span class="hljs-attr">leader</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">player2</span>: <span class="hljs-number">0</span>
        }
        rooms[room].game.card1 = <span class="hljs-literal">null</span>;
        rooms[room].game.card2 = <span class="hljs-literal">null</span>;
        rooms[room].cards = super_arr;
        logger.silly(rooms);
    }
    socket.on(<span class="hljs-string">"click_card"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{;
        <span class="hljs-keyword">var</span> room = findRoomName(key);
        logger.silly(<span class="hljs-string">'card click in room '</span>+room);
        <span class="hljs-keyword">if</span>(key == rooms[room].gameInfo[rooms[room].game.turn]){
            <span class="hljs-keyword">if</span>(rooms[room].game.card1 ==<span class="hljs-literal">null</span>){
                rooms[room].game.card1 = rooms[room].cards[data.number];
                io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2).emit(<span class="hljs-string">"flip_card"</span>, {<span class="hljs-attr">number</span> : data.number, <span class="hljs-attr">text</span> :rooms[room].game.card1});
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(rooms[room].game.card1 == rooms[room].cards[data.number]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>do nothing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(rooms[room].game.card2 == <span class="hljs-literal">null</span>){
                rooms[room].game.card2 =rooms[room].cards[data.number];
                io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2).emit(<span class="hljs-string">"flip_card"</span>, {<span class="hljs-attr">number</span> : data.number, <span class="hljs-attr">text</span>: rooms[room].game.card2});
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span>(findCP(rooms[room].game.card1)==rooms[room].game.card2){ <span class="hljs-comment">// was right</span>
                    <span class="hljs-keyword">if</span>(key == rooms[room].gameInfo.leader){
                        rooms[room].scores.leader++;
                        io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2)
                            .emit(<span class="hljs-string">"gameInfo"</span>, {<span class="hljs-attr">type</span>: <span class="hljs-string">"notif"</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"score"</span>, <span class="hljs-attr">person</span>: <span class="hljs-string">"leader"</span>, <span class="hljs-attr">score</span>:rooms[room].scores.leader });
                    } <span class="hljs-keyword">else</span> {
                        rooms[room].scores.player2++;
                        io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2)
                            .emit(<span class="hljs-string">"gameInfo"</span>, {<span class="hljs-attr">type</span>: <span class="hljs-string">"notif"</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"score"</span>, <span class="hljs-attr">person</span>: <span class="hljs-string">"player2"</span>, <span class="hljs-attr">score</span>:rooms[room].scores.player2});
                    }
                    io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2)
                        .emit(<span class="hljs-string">"remove_card"</span>, {<span class="hljs-attr">number</span>: findKey(rooms[room].game.card2, rooms[room].cards)});
                    io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2)
                        .emit(<span class="hljs-string">"remove_card"</span>, {<span class="hljs-attr">number</span>: findKey(rooms[room].game.card1, rooms[room].cards)});
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span>(rooms[room].game.turn == <span class="hljs-string">"leader"</span>){
                        rooms[room].game.turn = <span class="hljs-string">"player2"</span>;
                    } <span class="hljs-keyword">else</span> {
                        rooms[room].game.turn = <span class="hljs-string">"leader"</span>;
                    }
                    io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2)
                        .emit(<span class="hljs-string">"flip_card"</span>, {<span class="hljs-attr">number</span>: findKey(rooms[room].game.card2, rooms[room].cards), <span class="hljs-attr">text</span>: <span class="hljs-string">"Don't Cheat"</span>});
                    io.to(rooms[room].gameInfo.leader).to(rooms[room].gameInfo.player2)
                        .emit(<span class="hljs-string">"flip_card"</span>, {<span class="hljs-attr">number</span>: findKey(rooms[room].game.card1, rooms[room].cards), <span class="hljs-attr">text</span>: <span class="hljs-string">"Don't Cheat"</span>});
                }
                rooms[room].game.card2 = <span class="hljs-literal">null</span>;
                rooms[room].game.card1 = <span class="hljs-literal">null</span>;
            }
        } <span class="hljs-keyword">else</span> {
            io.to(key).emit(<span class="hljs-string">"message"</span>, {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"Not your turn!"</span>});
        }
        logger.silly(rooms);
    });
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findRoomName</span>(<span class="hljs-params">key</span>)</span>{
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> rooms){
            <span class="hljs-keyword">if</span>(rooms[a].gameInfo.leader == key || rooms[a].gameInfo.player2 == key){
                <span class="hljs-keyword">return</span> a;
            }
        }
    }
    socket.on(<span class="hljs-string">"disconnect"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> rooms) {
            <span class="hljs-keyword">if</span> (rooms[a].gameInfo == <span class="hljs-literal">null</span> || rooms[a].gameInfo.leader == key) {
                <span class="hljs-keyword">var</span> other = <span class="hljs-string">"player2"</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> other = <span class="hljs-string">"leader"</span>;
            }
            <span class="hljs-keyword">if</span> (rooms[a].hasOwnProperty() &amp;&amp; (rooms[a].gameInfo.leader == <span class="hljs-literal">null</span> &amp;&amp; rooms[a].gameInfo.player2==<span class="hljs-literal">null</span>)) {
                <span class="hljs-keyword">delete</span> rooms[a];
                logger.error(<span class="hljs-string">"Deleted room "</span> + a + <span class="hljs-string">", the room's info was undefined or no other player was in it. "</span>);
                logger.silly(rooms);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rooms[a].hasOwnProperty() &amp;&amp; rooms[a].gameInfo.leader == key) {
                rooms[a].gameInfo.leader = <span class="hljs-literal">null</span>;
                rooms[a].abandoned = <span class="hljs-literal">true</span>;
                logger.info(users[key].username + <span class="hljs-string">" just left room "</span> + a + <span class="hljs-string">", marked as abandoned."</span>);
                io.to(rooms[a].gameInfo.player2).emit(<span class="hljs-string">"gameInfo"</span>, {
                    <span class="hljs-attr">type</span>: <span class="hljs-string">"notif"</span>,
                    <span class="hljs-attr">message</span>: <span class="hljs-string">"opponent_abandoned"</span>
                });
                logger.info(<span class="hljs-string">"Sent abandoned, win notification to "</span> + users[rooms[a].gameInfo.player2].username)
                logger.silly(rooms);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rooms[a].hasOwnProperty() &amp;&amp; rooms[a].gameInfo.player2 == key) {
                rooms[a].gameInfo.player2 = <span class="hljs-literal">null</span>;
                rooms[a].abandoned = <span class="hljs-literal">true</span>;
                logger.info(users[key].username + <span class="hljs-string">" just left room "</span> + a + <span class="hljs-string">", marked as abandoned."</span>);
                io.to(rooms[a].gameInfo.leader).emit(<span class="hljs-string">"gameInfo"</span>, {
                    <span class="hljs-attr">type</span>: <span class="hljs-string">"notif"</span>,
                    <span class="hljs-attr">message</span>: <span class="hljs-string">"opponent_abandoned"</span>
                });
                logger.info(<span class="hljs-string">"Sent abandoned, win notification to "</span> + users[rooms[a].gameInfo.leader].username)
                logger.silly(rooms);
            }
        }
        logger.info(<span class="hljs-string">"-1 user. Key: "</span> + key + <span class="hljs-string">" Total: "</span> + samyok.count(users));
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> lobbies) {
            <span class="hljs-keyword">delete</span> lobbies[a][key];
            logger.info(<span class="hljs-string">"Removed user "</span> + users[key].username + <span class="hljs-string">" from lobby "</span> + a);
        }
        logger.info(<span class="hljs-string">"Deleting "</span> + users[key].username);
        <span class="hljs-keyword">delete</span> users[key];
        users.clean(<span class="hljs-literal">null</span>); <span class="hljs-comment">// look for null and get rid of it.</span>
    });
});
<span class="hljs-keyword">var</span> roomNumber = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randInt</span>(<span class="hljs-params">min, max</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(min + <span class="hljs-built_in">Math</span>.random() * (max + <span class="hljs-number">1</span> - min))
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create_room</span>(<span class="hljs-params">type, key</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> lobbies) {
        <span class="hljs-keyword">delete</span> lobbies[a][key];
    } <span class="hljs-comment">// remove from lobby</span>
    roomNumber += randInt(<span class="hljs-number">9</span>, <span class="hljs-number">20</span>);
    <span class="hljs-keyword">var</span> room_name = <span class="hljs-string">"room"</span> + roomNumber.toString();
    rooms[room_name] = <span class="hljs-keyword">new</span> place();
    rooms[room_name].type = type;
    rooms[room_name].gameInfo = {};
    rooms[room_name].game = {};
    rooms[<span class="hljs-string">"room"</span> + roomNumber.toString()].gameInfo.leader = key;
    rooms[room_name].ready = {};
    rooms[room_name].ready.leader = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"double"</span>) {
        rooms[room_name].gameInfo.player2 = <span class="hljs-literal">null</span>;
        rooms[room_name].ready.player2 = <span class="hljs-literal">false</span>;
    }
    rooms[room_name].started = <span class="hljs-literal">false</span>;
    rooms[room_name].abandoned = <span class="hljs-literal">false</span>;
    logger.silly(rooms);
    <span class="hljs-keyword">return</span> room_name;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">join_room</span>(<span class="hljs-params">code, key</span>) </span>{
    <span class="hljs-keyword">if</span> (rooms[code] == <span class="hljs-literal">null</span> || rooms[code].abandoned) {
        io.to(key).emit(<span class="hljs-string">"join_response"</span>, {
            <span class="hljs-attr">message</span>: <span class="hljs-string">"error"</span>,
            <span class="hljs-attr">reason</span>: <span class="hljs-string">"Not a real room."</span>
        });
        logger.info(key + <span class="hljs-string">" just tried to go to room "</span> + code);
        logger.silly(rooms);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        rooms[code].gameInfo.player2 = key;
        io.to(rooms[code].gameInfo.leader).emit(<span class="hljs-string">"player_joined"</span>, {
            <span class="hljs-attr">player</span>: users[key].username
        });
        logger.silly(rooms);
        io.to(key).emit(<span class="hljs-string">"join_response"</span>, {
            <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
            <span class="hljs-attr">code</span>: code,
            <span class="hljs-attr">player</span>: users[rooms[code].gameInfo.leader].username
        });
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findCP</span>(<span class="hljs-params">cardText</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> number <span class="hljs-keyword">in</span> blah) {
        <span class="hljs-keyword">if</span> (blah[number].question == cardText) {
            <span class="hljs-keyword">return</span> blah[number].answer;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (blah[number].answer == cardText) {
            <span class="hljs-keyword">return</span> blah[number].question;
        }
    }
}
<span class="hljs-comment">/**
 * Finds a key with an element
 * @param {string} needle the needle in the haystack
 * @param {object} haystak the haystack the needle is in
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findKey</span>(<span class="hljs-params">needle, haystack</span>)</span>{
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> a <span class="hljs-keyword">in</span> haystack){
        <span class="hljs-keyword">if</span>(haystack[a] == needle){
            <span class="hljs-keyword">return</span> a;
        }
    }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
